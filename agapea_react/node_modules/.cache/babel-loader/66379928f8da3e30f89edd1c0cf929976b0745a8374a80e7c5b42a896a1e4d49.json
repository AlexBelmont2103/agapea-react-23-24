{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\thard\\\\OneDrive\\\\Documentos\\\\DAW\\\\Segundo\\\\entornoCliente\\\\agapea_react\\\\src\\\\componentes\\\\zonaTienda\\\\pedidosComponente\\\\FinalizarPedidoOk.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { Link, useSearchParams } from 'react-router-dom';\nimport { useClienteLoggedContext } from '../../../contextProviders/clienteLoggedContext';\nimport { RecuperarDatosCliente } from '../../../servicios/restCliente';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction FinalizarPedidoOk({\n  props\n}) {\n  _s();\n  //parametros recibidos en la url desde servicio nodejs si pago con paypal...\n  let [searchParams, setSearchParams] = useSearchParams(); //en searchParams te devuelve un objeto URLSearchParams\n\n  let _idcliente = searchParams.get('idcliente');\n  let _idpedido = searchParams.get('idpedido');\n  let _jwtUnUso = searchParams.get('token');\n\n  //#region --------------- state manejado por el componente (global por context-api o local) ------------------\n  let {\n    clienteLogged,\n    dispatch\n  } = useClienteLoggedContext();\n  let [datosClienteLogged, setDatosClienteLogged] = useState(null);\n  let [pedidoFinalizado, setPedidoFinalizado] = useState(null);\n  //#endregion\n\n  //#region --------------- efectos del componente -------------------------------------------------------------\n  //recuperar de nuevo los datos del cliente (en pago por paypal pq el contexto global ha desaparecido....)\n  useEffect(() => {\n    async function ObtenerDatosCliente() {\n      let _respServer = await RecuperarDatosCliente(_idcliente, _jwtUnUso);\n      let _datosCliente = _respServer.codigo === 0 ? _respServer.datoscliente : null;\n      console.log(\"Respuesta del server...\", _respServer);\n      console.log(\"Payload para actualizar contexto global...\", _payload);\n      if (_datosCliente) {\n        //hacer dispatch para el reducer para volver a crear contexto global con datos del cliente actualizados...\n        let _payload = {\n          datoscliente: _respServer.datoscliente,\n          jwt: datoscliente.jwt\n        };\n        console.log(\"Payload para actualizar contexto global...\", _payload);\n        setDatosClienteLogged(_datosCliente);\n        setPedidoFinalizado(_datosCliente.pedidos.filter(ped => ped._id === _idpedido)[0]);\n        dispatch({\n          type: 'CLIENTE_RECUPERAR',\n          payload: _payload\n        });\n        console.log(\"Datos cliente en contexto global actualizados...\", clienteLogged);\n      }\n    }\n    ObtenerDatosCliente();\n  }, []);\n\n  //#endregion\n\n  //#region --------------- funciones manejadoras de eventos ----------------------------------------------------\n  //#endregion\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: datosClienteLogged ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/images/pedidoOK.jpg\",\n          style: {\n            width: \"200px\",\n            height: \"200px\"\n          },\n          alt: \"...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: /*#__PURE__*/_jsxDEV(\"h5\", {\n              children: [\"Pago del pedido con id: \", pedidoFinalizado._id, \" realizado correctamente\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 63,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 63,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Has pagado \", pedidoFinalizado.totalPedido, \"\\u20AC en fecha: \", pedidoFinalizado.fechaPedido, \" en Agapea.com\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Se te ha mandado un email a \", /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                color: 'cyan'\n              },\n              children: datosClienteLogged.cuenta.email\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 70,\n              columnNumber: 60\n            }, this), \" con la factura del mismo (consulta la bandeja de entrada de tu correo o el spam por si acaso).\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \" Accede al panel de tu USUARIO para ver la lista de pedidos que has hecho en la tienda.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row d-flex justify-content-center\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          className: \"btn btn-success btn-lg\",\n          to: \"/Cliente/Panel/InicioPanel\",\n          children: \"IR A MI PANEL\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Espera un momento...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"spinner-border ms-auto\",\n          role: \"status\",\n          \"aria-hidden\": \"true\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 21\n      }, this)\n    }, void 0, false)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 52,\n    columnNumber: 13\n  }, this);\n}\n_s(FinalizarPedidoOk, \"eikVoCjJ6XsdKKSUZl778dmAJIE=\", false, function () {\n  return [useSearchParams, useClienteLoggedContext];\n});\n_c = FinalizarPedidoOk;\nexport default FinalizarPedidoOk;\nvar _c;\n$RefreshReg$(_c, \"FinalizarPedidoOk\");","map":{"version":3,"names":["useState","useEffect","Link","useSearchParams","useClienteLoggedContext","RecuperarDatosCliente","jsxDEV","_jsxDEV","Fragment","_Fragment","FinalizarPedidoOk","props","_s","searchParams","setSearchParams","_idcliente","get","_idpedido","_jwtUnUso","clienteLogged","dispatch","datosClienteLogged","setDatosClienteLogged","pedidoFinalizado","setPedidoFinalizado","ObtenerDatosCliente","_respServer","_datosCliente","codigo","datoscliente","console","log","_payload","jwt","pedidos","filter","ped","_id","type","payload","className","children","src","style","width","height","alt","fileName","_jsxFileName","lineNumber","columnNumber","totalPedido","fechaPedido","color","cuenta","email","to","role","_c","$RefreshReg$"],"sources":["C:/Users/thard/OneDrive/Documentos/DAW/Segundo/entornoCliente/agapea_react/src/componentes/zonaTienda/pedidosComponente/FinalizarPedidoOk.js"],"sourcesContent":["import {useState, useEffect } from 'react';\r\nimport { Link, useSearchParams } from 'react-router-dom'; \r\n \r\nimport { useClienteLoggedContext } from '../../../contextProviders/clienteLoggedContext'\r\nimport {RecuperarDatosCliente} from '../../../servicios/restCliente'\r\n\r\nfunction FinalizarPedidoOk( {props} ) {\r\n       //parametros recibidos en la url desde servicio nodejs si pago con paypal...\r\n       let [ searchParams, setSearchParams ]=useSearchParams(); //en searchParams te devuelve un objeto URLSearchParams\r\n       \r\n       let _idcliente=searchParams.get('idcliente');\r\n       let _idpedido=searchParams.get('idpedido');\r\n       let _jwtUnUso=searchParams.get('token');\r\n       \r\n        //#region --------------- state manejado por el componente (global por context-api o local) ------------------\r\n        let { clienteLogged, dispatch }=useClienteLoggedContext();\r\n\r\n        let [ datosClienteLogged, setDatosClienteLogged]=useState(null);\r\n        let [ pedidoFinalizado, setPedidoFinalizado]=useState(null);\r\n        //#endregion\r\n\r\n        //#region --------------- efectos del componente -------------------------------------------------------------\r\n        //recuperar de nuevo los datos del cliente (en pago por paypal pq el contexto global ha desaparecido....)\r\n        useEffect(\r\n            () => {\r\n                async function ObtenerDatosCliente(){\r\n                    let _respServer=await RecuperarDatosCliente(_idcliente, _jwtUnUso);\r\n                    let _datosCliente=_respServer.codigo===0? _respServer.datoscliente : null;\r\n                    console.log(\"Respuesta del server...\",_respServer);\r\n                    \r\n                    console.log(\"Payload para actualizar contexto global...\",_payload);\r\n                    if(_datosCliente){\r\n                        //hacer dispatch para el reducer para volver a crear contexto global con datos del cliente actualizados...\r\n                        let _payload={datoscliente: _respServer.datoscliente, jwt: datoscliente.jwt};\r\n                        console.log(\"Payload para actualizar contexto global...\",_payload);\r\n                        setDatosClienteLogged(_datosCliente);\r\n                        setPedidoFinalizado(_datosCliente.pedidos.filter(ped=>ped._id===_idpedido)[0]);\r\n                        dispatch({type:'CLIENTE_RECUPERAR', payload: _payload});\r\n                        console.log(\"Datos cliente en contexto global actualizados...\",clienteLogged);\r\n                    }\r\n                }\r\n                ObtenerDatosCliente();\r\n                }, []);\r\n        \r\n        //#endregion\r\n\r\n        //#region --------------- funciones manejadoras de eventos ----------------------------------------------------\r\n        //#endregion\r\n\r\n\r\n        return (\r\n            <div className=\"container\">\r\n            {\r\n                datosClienteLogged ? \r\n                <>\r\n\r\n                    <div className=\"row\">\r\n                        <img src=\"/images/pedidoOK.jpg\" style={{width: \"200px\", height: \"200px\"}} alt=\"...\"/>\r\n                    </div>\r\n\r\n                    <div className=\"row\">\r\n                        <div className=\"col\">\r\n                            <p><h5>Pago del pedido con id: {pedidoFinalizado._id} realizado correctamente</h5></p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"row\">\r\n                        <div className=\"col\">\r\n                            <p>Has pagado {pedidoFinalizado.totalPedido}€ en fecha: {pedidoFinalizado.fechaPedido} en Agapea.com</p>\r\n                            <p>Se te ha mandado un email a <span style={{color:'cyan'}}>{\r\n                                        datosClienteLogged.cuenta.email\r\n                            }</span> con la factura del mismo (consulta la bandeja de entrada de tu correo o el spam por si acaso).</p>\r\n                            <br />\r\n                            <p> Accede al panel de tu USUARIO para ver la lista de pedidos que has hecho en la tienda.</p>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"row d-flex justify-content-center\">\r\n                        <Link className=\"btn btn-success btn-lg\" to=\"/Cliente/Panel/InicioPanel\">IR A MI PANEL</Link>\r\n                    </div>\r\n\r\n\r\n                \r\n                </>\r\n\r\n                :\r\n\r\n                <>\r\n                    {/* ....spinner mientras recupero datos cliente.... */}\r\n                    <div className=\"d-flex align-items-center\">\r\n                        <strong>Espera un momento...</strong>\r\n                        <div className=\"spinner-border ms-auto\" role=\"status\" aria-hidden=\"true\"></div>\r\n                    </div>                    \r\n                </>\r\n            }\r\n            </div> \r\n               \r\n        );\r\n}\r\n\r\nexport default FinalizarPedidoOk;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}